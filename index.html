<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathApp — CAS Calculator</title>

    <!-- MathQuill dependencies -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/mathquill.min.css">
    <!-- KaTeX (matrix / advanced LaTeX rendering) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <link rel="stylesheet" href="css/style.css">

    <!-- jQuery (required by MathQuill) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- MathQuill -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/mathquill.min.js"></script>
    <!-- KaTeX -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <!-- Pyodide -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.27.4/full/pyodide.js"></script>
</head>
<body>
    <div id="app">
        <header id="app-header">
            <h1>MathApp</h1>
            <div id="status-bar">
                <span id="engine-status" class="status-loading">Loading CAS engine…</span>
            </div>
        </header>
        <!-- Symbol Picker Toolbar -->
        <div id="symbol-picker">
            <div class="picker-group" data-group="greek">
                <span class="picker-label">Greek</span>
                <button class="picker-btn" data-latex="\pi" title="pi">π</button>
                <button class="picker-btn" data-latex="\alpha" title="alpha">α</button>
                <button class="picker-btn" data-latex="\beta" title="beta">β</button>
                <button class="picker-btn" data-latex="\gamma" title="gamma">γ</button>
                <button class="picker-btn" data-latex="\delta" title="delta">δ</button>
                <button class="picker-btn" data-latex="\epsilon" title="epsilon">ε</button>
                <button class="picker-btn" data-latex="\theta" title="theta">θ</button>
                <button class="picker-btn" data-latex="\lambda" title="lambda">λ</button>
                <button class="picker-btn" data-latex="\mu" title="mu">μ</button>
                <button class="picker-btn" data-latex="\sigma" title="sigma">σ</button>
                <button class="picker-btn" data-latex="\phi" title="phi">φ</button>
                <button class="picker-btn" data-latex="\omega" title="omega">ω</button>
            </div>
            <div class="picker-group" data-group="calculus">
                <span class="picker-label">Calculus</span>
                <button class="picker-btn" data-latex="\int" title="Integral">∫</button>
                <button class="picker-btn" data-latex="\frac{d}{dx}" title="Derivative d/dx">d/dx</button>
                <button class="picker-btn" data-latex="\sum" title="Summation">Σ</button>
                <button class="picker-btn" data-latex="\prod" title="Product">Π</button>
                <button class="picker-btn" data-latex="\lim" title="Limit">lim</button>
                <button class="picker-btn" data-latex="\infty" title="Infinity">∞</button>
            </div>
            <div class="picker-group" data-group="operators">
                <span class="picker-label">Ops</span>
                <button class="picker-btn" data-latex="\sqrt{}" title="Square root">√</button>
                <button class="picker-btn" data-latex="\frac{}{}" title="Fraction">a/b</button>
                <button class="picker-btn" data-latex="^{}" title="Exponent">x^n</button>
                <button class="picker-btn" data-latex="_{}" title="Subscript">x_n</button>
                <button class="picker-btn" data-latex="\cdot" title="Multiplication dot">·</button>
                <button class="picker-btn" data-latex="\times" title="Cross multiply">×</button>
                <button class="picker-btn" data-latex="\pm" title="Plus-minus">±</button>
                <button class="picker-btn" data-latex="\leq" title="Less than or equal">≤</button>
                <button class="picker-btn" data-latex="\geq" title="Greater than or equal">≥</button>
                <button class="picker-btn" data-latex="\neq" title="Not equal">≠</button>
            </div>
            <div class="picker-group" data-group="functions">
                <span class="picker-label">Funcs</span>
                <button class="picker-btn" data-latex="\sin" title="Sine">sin</button>
                <button class="picker-btn" data-latex="\cos" title="Cosine">cos</button>
                <button class="picker-btn" data-latex="\tan" title="Tangent">tan</button>
                <button class="picker-btn" data-latex="\ln" title="Natural log">ln</button>
                <button class="picker-btn" data-latex="\log" title="Logarithm">log</button>
                <button class="picker-btn" data-latex="e^{}" title="Exponential">e^x</button>
                <button class="picker-btn" data-latex="|" data-wrap="true" title="Absolute value">|x|</button>
            </div>
            <!-- Matrix picker group -->
            <div class="picker-group" data-group="matrix">
                <span class="picker-label">Matrix</span>
                <div class="matrix-picker-wrap" id="matrix-picker-wrap">
                    <button class="picker-btn matrix-picker-trigger" id="matrix-picker-btn" title="Insert matrix">⊞ Matrix</button>
                    <!-- Size selector popup -->
                    <div class="matrix-size-popup" id="matrix-size-popup">
                        <div class="matrix-size-label" id="matrix-size-label">Select size</div>
                        <div class="matrix-size-grid" id="matrix-size-grid"></div>
                    </div>
                </div>
                <!-- Quick matrix command buttons -->
                <button class="picker-btn" data-matrix-cmd="det" title="Determinant: det(M)">det</button>
                <button class="picker-btn" data-matrix-cmd="inv" title="Inverse: inv(M)">inv</button>
                <button class="picker-btn" data-matrix-cmd="transpose" title="Transpose: transpose(M)">Tᵀ</button>
                <button class="picker-btn" data-matrix-cmd="eigenvals" title="Eigenvalues: eigenvals(M)">λ</button>
                <button class="picker-btn" data-matrix-cmd="rref" title="Row echelon: rref(M)">rref</button>
            </div>
        </div>

        <!-- Matrix input modal -->
        <div id="matrix-modal" class="matrix-modal" aria-hidden="true">
            <div class="matrix-modal-box">
                <div class="matrix-modal-header">
                    <span id="matrix-modal-title">Insert Matrix</span>
                    <button class="matrix-modal-close" id="matrix-modal-close" title="Cancel">✕</button>
                </div>
                <div class="matrix-modal-name-row">
                    <label for="matrix-name-input">Assign to variable (optional):</label>
                    <input type="text" id="matrix-name-input" placeholder="e.g. A" maxlength="20">
                </div>
                <div class="matrix-modal-grid-wrap">
                    <div id="matrix-modal-grid" class="matrix-modal-grid"></div>
                </div>
                <div class="matrix-modal-footer">
                    <button class="btn-secondary" id="matrix-modal-cancel">Cancel</button>
                    <button class="btn-primary" id="matrix-modal-insert">Insert &amp; Evaluate</button>
                </div>
            </div>
        </div>

        <main id="notebook"></main>
    </div>

    <!-- Load application modules -->
    <script src="js/latexParser.js"></script>
    <script src="js/loadPyodide.js"></script>
    <script src="js/sendExpression.js"></script>
    <script src="js/rowManager.js"></script>
    <script src="js/matrixPicker.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
